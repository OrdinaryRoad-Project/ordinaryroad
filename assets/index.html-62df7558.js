import{_ as l}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o as c,c as p,a as n,b as s,d as t,e}from"./app-02009871.js";const o={},u=e('<h1 id="livechatclient弹幕客户端" tabindex="-1"><a class="header-anchor" href="#livechatclient弹幕客户端" aria-hidden="true">#</a> LiveChatClient弹幕客户端</h1><p><img src="https://img.shields.io/github/license/OrdinaryRoad-Project/ordinaryroad-live-chat-client" alt="license" loading="lazy"> <img src="https://img.shields.io/github/v/release/OrdinaryRoad-Project/ordinaryroad-live-chat-client" alt="release" loading="lazy"> <img src="https://img.shields.io/maven-central/v/tech.ordinaryroad/live-chat-client" alt="Maven Central" loading="lazy"></p>',2),k=n("p",null,"This project is in progress... 👨‍💻",-1),d={href:"https://github.com/OrdinaryRoad-Project/ordinaryroad-live-chat-client/issues",target:"_blank",rel:"noopener noreferrer"},r=n("br",null,null,-1),m={href:"https://github.com/OrdinaryRoad-Project/ordinaryroad-live-chat-client/discussions",target:"_blank",rel:"noopener noreferrer"},b=n("br",null,null,-1),h={href:"https://github.com/orgs/OrdinaryRoad-Project/projects/1",target:"_blank",rel:"noopener noreferrer"},v=e(`<ul class="task-list-container"><li class="task-list-item"><p><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> Bilibili</label></p><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> BilibiliLiveChatClient</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> 支持 cookie</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> 支持 短房间id</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-4" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-4"> 支持 弹幕发送</label></li></ul></li><li class="task-list-item"><p><input type="checkbox" class="task-list-item-checkbox" id="task-item-5" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-5"> Douyu</label></p><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-6" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-6"> DouyuLiveChatClient</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-7" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-7"> 支持 cookie</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-8" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-8"> 支持 短房间id</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-9" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-9"> 支持 弹幕发送</label></li></ul></li><li class="task-list-item"><p><input type="checkbox" class="task-list-item-checkbox" id="task-item-10" disabled="disabled"><label class="task-list-item-label" for="task-item-10"> Huya</label></p></li><li class="task-list-item"><p><input type="checkbox" class="task-list-item-checkbox" id="task-item-11" disabled="disabled"><label class="task-list-item-label" for="task-item-11"> ...</label></p></li></ul><hr><p>Live room WebSocket chat client</p><ul><li>Feature 0: Netty</li><li>Feature 1: 消息中的未知属性统一放到单独的MAP中</li><li>Feature 2: 支持自动重连</li><li>Feature 3: 支持同时监听多个直播间</li><li>Feature 4: 支持直播间短id</li><li>Feature 5: 支持弹幕发送</li><li>Feature 6: 内置收到弹幕、收到礼物回调</li></ul><h2 id="_1-安装" tabindex="-1"><a class="header-anchor" href="#_1-安装" aria-hidden="true">#</a> 1 安装</h2><h3 id="b站" tabindex="-1"><a class="header-anchor" href="#b站" aria-hidden="true">#</a> B站</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tech.ordinaryroad<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>live-chat-client-bilibili<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 参考github release版本，不需要前缀\`v\` --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${ordinaryroad-live-chat-client.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="斗鱼" tabindex="-1"><a class="header-anchor" href="#斗鱼" aria-hidden="true">#</a> 斗鱼</h3><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>tech.ordinaryroad<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>live-chat-client-douyu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 参考github release版本，不需要前缀\`v\` --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>\${ordinaryroad-live-chat-client.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-使用" tabindex="-1"><a class="header-anchor" href="#_2-使用" aria-hidden="true">#</a> 2 使用</h2><blockquote><p>测试类包含了多种样例，可供参考</p></blockquote><h3 id="_2-1-client模式" tabindex="-1"><a class="header-anchor" href="#_2-1-client模式" aria-hidden="true">#</a> 2.1 Client模式</h3>`,12),g={href:"https://github.com/OrdinaryRoad-Project/ordinaryroad-live-chat-client/tree/main/live-chat-client-examples/client-example",target:"_blank",rel:"noopener noreferrer"},f=e(`<div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientModeExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> cookie <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">&quot;cookie&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BilibiliLiveChatClientConfig</span> config <span class="token operator">=</span> <span class="token class-name">BilibiliLiveChatClientConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// TODO 浏览器Cookie</span>
                <span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>
                <span class="token comment">// TODO 直播间id（支持短id）</span>
                <span class="token punctuation">.</span><span class="token function">roomId</span><span class="token punctuation">(</span><span class="token number">7777</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">BilibiliLiveChatClient</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BilibiliLiveChatClient</span><span class="token punctuation">(</span>config<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IBilibiliMsgListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDanmuMsg</span><span class="token punctuation">(</span><span class="token class-name">BilibiliBinaryFrameHandler</span> binaryFrameHandler<span class="token punctuation">,</span> <span class="token class-name">DanmuMsgMsg</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">IBilibiliMsgListener</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDanmuMsg</span><span class="token punctuation">(</span>binaryFrameHandler<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;%s 收到弹幕 %s(%d)：%s%n&quot;</span><span class="token punctuation">,</span> binaryFrameHandler<span class="token punctuation">.</span><span class="token function">getRoomId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onGiftMsg</span><span class="token punctuation">(</span><span class="token class-name">BilibiliBinaryFrameHandler</span> binaryFrameHandler<span class="token punctuation">,</span> <span class="token class-name">SendGiftMsg</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">IBilibiliMsgListener</span><span class="token punctuation">.</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onGiftMsg</span><span class="token punctuation">(</span>binaryFrameHandler<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
             
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;{} 收到礼物 {}({}) {} {}({})x{}({})&quot;</span><span class="token punctuation">,</span> binaryFrameHandler<span class="token punctuation">.</span><span class="token function">getRoomId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getGiftName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getGiftId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getGiftCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">.</span><span class="token function">getGiftPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        client<span class="token punctuation">.</span><span class="token function">addStatusChangeListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PropertyChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">propertyChange</span><span class="token punctuation">(</span><span class="token class-name">PropertyChangeEvent</span> evt<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>evt<span class="token punctuation">.</span><span class="token function">getNewValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">ClientStatusEnums</span><span class="token punctuation">.</span><span class="token constant">CONNECTED</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// TODO 要发送的弹幕内容，请注意控制发送频率；框架内置支持设置发送弹幕的最少时间间隔，小于时将忽略该次发送</span>
                    client<span class="token punctuation">.</span><span class="token function">sendDanmu</span><span class="token punctuation">(</span><span class="token string">&quot;666666&quot;</span> <span class="token operator">+</span> <span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">randomNumbers</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-高级模式" tabindex="-1"><a class="header-anchor" href="#_2-2-高级模式" aria-hidden="true">#</a> 2.2 高级模式</h3>`,2),y={href:"https://github.com/OrdinaryRoad-Project/ordinaryroad-live-chat-client/tree/main/live-chat-client-examples/handler-example/src/main/java/tech/ordinaryroad/live/chat/client/example/handler/BilibiliHandlerModeExample.java",target:"_blank",rel:"noopener noreferrer"},x=e('<h2 id="_3-项目说明" tabindex="-1"><a class="header-anchor" href="#_3-项目说明" aria-hidden="true">#</a> 3 项目说明</h2><ul><li>commons（主要是抽象接口、抽象类的定义） <ul><li>commons-base <ul><li>定义了一些基础的接口、抽象类：消息、消息监听器、连接连监听器</li><li>消息 <ul><li>msg：收到的所有msg <ul><li>cmdMsg：有些平台的一些消息正文中没有消息类型cmd字段，例如B站的心跳包，因此再细分为cmdMsg</li></ul></li><li>IDanmuMsg: 内置用户名、弹幕内容等方法</li><li>IGiftMsg：内置发送方、接收方、礼物ID、礼物个数等</li></ul></li><li>消息监听器 <ul><li>onDanmuMsg：收到弹幕消息</li><li>onGiftMsg：收到礼物消息</li><li>onMsg：所有消息（不管消息内容）都会调用</li><li>onCmdMsg：cmd消息（消息体中有表示消息类型的字段时），并且该类型需要处理（例如心跳回复包不需要处理）时调用</li><li>onOtherCmdMsg：该消息类型不需要处理（例如PK、点赞数更新等类型）时调用</li><li>onUnknownCmd：该消息类型未知（没有对应的枚举类）时调用</li></ul></li></ul></li><li>commons-client <ul><li>定义了Client的配置：连接地址、房间id、Cookie、心跳、自动重连等相关参数</li><li>定义了Client的一些方法：初始化、连接、断开、发送消息等</li><li>定义了Client的生命周期</li></ul></li><li>commons-util <ul><li>一些工具类：时间、反射、Cookie</li></ul></li></ul></li><li>servers（对使用的连接工具的抽象） <ul><li>servers-netty <ul><li>定义了连接处理Handler</li><li>定义了数据处理Handler</li></ul></li><li>servers-netty-client（基于netty实现的Client） <ul><li>扩展了Client、ClientConfig</li><li>扩展Handler增加了Client成员变量</li></ul></li></ul></li><li>clients（对servers-netty-client的具体实现） <ul><li>client-bilibili</li><li>client-douyu</li></ul></li></ul><h2 id="感谢以下开源项目" tabindex="-1"><a class="header-anchor" href="#感谢以下开源项目" aria-hidden="true">#</a> 感谢以下开源项目</h2>',3),_={href:"https://github.com/cj1128/douyu-crawler-demo",target:"_blank",rel:"noopener noreferrer"};function C(w,M){const a=i("ExternalLinkIcon");return c(),p("div",null,[u,n("blockquote",null,[k,n("p",null,[s("有问题欢迎提交"),n("a",d,[s("issuse"),t(a)]),s("，"),r,s(" 觉得有用的话可以点个小星星⭐️鼓励一下，感谢")]),n("p",null,[s("如果对项目感兴趣也欢迎"),n("a",m,[s("交流讨论"),t(a)]),s("，"),b,s(" 提交PR")]),n("p",null,[s("ToDo List: "),n("a",h,[s("https://github.com/orgs/OrdinaryRoad-Project/projects/1"),t(a)])])]),v,n("blockquote",null,[n("p",null,[s("Spring Boot 3 示例 "),n("a",g,[s("client-example"),t(a)])])]),f,n("blockquote",null,[n("p",null,[s("参考 "),n("a",y,[s("BilibiliHandlerModeExample"),t(a)])])]),x,n("ul",null,[n("li",null,[n("a",_,[s("douyu-crawler-demo"),t(a)]),s("（登录状态的请求包构建）")])])])}const O=l(o,[["render",C],["__file","index.html.vue"]]);export{O as default};
